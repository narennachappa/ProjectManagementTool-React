{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _every2 = require('lodash/every');\n\nvar _every3 = _interopRequireDefault(_every2);\n\nvar _isFunction2 = require('lodash/isFunction');\n\nvar _isFunction3 = _interopRequireDefault(_isFunction2);\n\nvar _invoke2 = require('lodash/invoke');\n\nvar _invoke3 = _interopRequireDefault(_invoke2);\n\nvar _isArray2 = require('lodash/isArray');\n\nvar _isArray3 = _interopRequireDefault(_isArray2);\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nexports.add = add;\nexports.set = set;\nexports.get = get;\nexports.update = update;\nexports.deleteRef = deleteRef;\nexports.setListener = setListener;\nexports.setListeners = setListeners;\nexports.unsetListener = unsetListener;\nexports.unsetListeners = unsetListeners;\nexports.runTransaction = runTransaction;\n\nvar _actions = require('../utils/actions');\n\nvar _constants = require('../constants');\n\nvar _query = require('../utils/query');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar pathListenerCounts = {};\n\nfunction add(firebase, dispatch, queryOption) {\n  for (var _len = arguments.length, args = Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {\n    args[_key - 3] = arguments[_key];\n  }\n\n  var meta = (0, _query.getQueryConfig)(queryOption);\n  return (0, _actions.wrapInDispatch)(dispatch, {\n    ref: (0, _query.firestoreRef)(firebase, dispatch, meta),\n    method: 'add',\n    meta: meta,\n    args: args,\n    types: [_constants.actionTypes.ADD_REQUEST, {\n      type: _constants.actionTypes.ADD_SUCCESS,\n      payload: function payload(snap) {\n        return {\n          id: snap.id,\n          data: args[0]\n        };\n      }\n    }, _constants.actionTypes.ADD_FAILURE]\n  });\n}\n\nfunction set(firebase, dispatch, queryOption) {\n  for (var _len2 = arguments.length, args = Array(_len2 > 3 ? _len2 - 3 : 0), _key2 = 3; _key2 < _len2; _key2++) {\n    args[_key2 - 3] = arguments[_key2];\n  }\n\n  var meta = (0, _query.getQueryConfig)(queryOption);\n  return (0, _actions.wrapInDispatch)(dispatch, {\n    ref: (0, _query.firestoreRef)(firebase, dispatch, meta),\n    method: 'set',\n    meta: meta,\n    args: args,\n    types: [_constants.actionTypes.SET_REQUEST, _constants.actionTypes.SET_SUCCESS, _constants.actionTypes.SET_FAILURE]\n  });\n}\n\nfunction get(firebase, dispatch, queryOption) {\n  var meta = (0, _query.getQueryConfig)(queryOption);\n\n  var _ref = firebase._.config || {},\n      mergeOrdered = _ref.mergeOrdered,\n      mergeOrderedDocUpdates = _ref.mergeOrderedDocUpdates,\n      mergeOrderedCollectionUpdates = _ref.mergeOrderedCollectionUpdates;\n\n  return (0, _actions.wrapInDispatch)(dispatch, {\n    ref: (0, _query.firestoreRef)(firebase, dispatch, meta),\n    method: 'get',\n    meta: meta,\n    types: [_constants.actionTypes.GET_REQUEST, {\n      type: _constants.actionTypes.GET_SUCCESS,\n      payload: function payload(snap) {\n        return {\n          data: (0, _query.dataByIdSnapshot)(snap),\n          ordered: (0, _query.orderedFromSnap)(snap)\n        };\n      },\n      merge: {\n        docs: mergeOrdered && mergeOrderedDocUpdates,\n        collections: mergeOrdered && mergeOrderedCollectionUpdates\n      }\n    }, _constants.actionTypes.GET_FAILURE]\n  });\n}\n\nfunction update(firebase, dispatch, queryOption) {\n  for (var _len3 = arguments.length, args = Array(_len3 > 3 ? _len3 - 3 : 0), _key3 = 3; _key3 < _len3; _key3++) {\n    args[_key3 - 3] = arguments[_key3];\n  }\n\n  var meta = (0, _query.getQueryConfig)(queryOption);\n  return (0, _actions.wrapInDispatch)(dispatch, {\n    ref: (0, _query.firestoreRef)(firebase, dispatch, meta),\n    method: 'update',\n    meta: meta,\n    args: args,\n    types: [_constants.actionTypes.UPDATE_REQUEST, _constants.actionTypes.UPDATE_SUCCESS, _constants.actionTypes.UPDATE_FAILURE]\n  });\n}\n\nfunction deleteRef(firebase, dispatch, queryOption) {\n  var meta = (0, _query.getQueryConfig)(queryOption);\n  var config = firebase._.config;\n\n  if (!meta.doc || meta.subcollections && !(0, _every3.default)(meta.subcollections, 'doc')) {\n    if ((0, _isFunction3.default)(config.onAttemptCollectionDelete)) {\n      return config.onAttemptCollectionDelete(queryOption, dispatch, firebase);\n    }\n\n    return Promise.reject(new Error('Only documents can be deleted.'));\n  }\n\n  return (0, _actions.wrapInDispatch)(dispatch, {\n    ref: (0, _query.firestoreRef)(firebase, dispatch, meta),\n    method: 'delete',\n    meta: meta,\n    types: [_constants.actionTypes.DELETE_REQUEST, {\n      type: _constants.actionTypes.DELETE_SUCCESS,\n      preserve: firebase._.config.preserveOnDelete\n    }, _constants.actionTypes.DELETE_FAILURE]\n  });\n}\n\nvar changeTypeToEventType = {\n  added: _constants.actionTypes.DOCUMENT_ADDED,\n  removed: _constants.actionTypes.DOCUMENT_REMOVED,\n  modified: _constants.actionTypes.DOCUMENT_MODIFIED\n};\n\nfunction docChangeEvent(change) {\n  var originalMeta = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  var meta = _extends({}, originalMeta, {\n    path: change.doc.ref.path\n  });\n\n  if (originalMeta.subcollections && !originalMeta.storeAs) {\n    meta.subcollections[0] = _extends({}, meta.subcollections[0], {\n      doc: change.doc.id\n    });\n  } else {\n    meta.doc = change.doc.id;\n  }\n\n  return {\n    type: changeTypeToEventType[change.type] || _constants.actionTypes.DOCUMENT_MODIFIED,\n    meta: meta,\n    payload: {\n      data: change.doc.data(),\n      ordered: {\n        oldIndex: change.oldIndex,\n        newIndex: change.newIndex\n      }\n    }\n  };\n}\n\nfunction setListener(firebase, dispatch, queryOpts, successCb, errorCb) {\n  var meta = (0, _query.getQueryConfig)(queryOpts);\n\n  var _ref2 = firebase._.config || {},\n      mergeOrdered = _ref2.mergeOrdered,\n      mergeOrderedDocUpdates = _ref2.mergeOrderedDocUpdates,\n      mergeOrderedCollectionUpdates = _ref2.mergeOrderedCollectionUpdates;\n\n  var unsubscribe = (0, _query.firestoreRef)(firebase, dispatch, meta).onSnapshot(function (docData) {\n    var docChanges = typeof docData.docChanges === 'function' ? docData.docChanges() : docData.docChanges;\n\n    if (docChanges && docChanges.length < docData.size) {\n      if (docChanges.length === 1) {\n        dispatch(docChangeEvent(docChanges[0], meta));\n      } else {\n        docChanges.forEach(function (change) {\n          dispatch(docChangeEvent(change, meta));\n        });\n      }\n    } else {\n      dispatch({\n        type: _constants.actionTypes.LISTENER_RESPONSE,\n        meta: meta,\n        payload: {\n          data: (0, _query.dataByIdSnapshot)(docData),\n          ordered: (0, _query.orderedFromSnap)(docData)\n        },\n        merge: {\n          docs: mergeOrdered && mergeOrderedDocUpdates,\n          collections: mergeOrdered && mergeOrderedCollectionUpdates\n        }\n      });\n    }\n\n    if (successCb) successCb(docData);\n  }, function (err) {\n    var _ref3 = firebase._.config || {},\n        logListenerError = _ref3.logListenerError,\n        preserveOnListenerError = _ref3.preserveOnListenerError;\n\n    if (logListenerError) (0, _invoke3.default)(console, 'error', err);\n    dispatch({\n      type: _constants.actionTypes.LISTENER_ERROR,\n      meta: meta,\n      payload: err,\n      merge: {\n        docs: mergeOrdered && mergeOrderedDocUpdates,\n        collections: mergeOrdered && mergeOrderedCollectionUpdates\n      },\n      preserve: preserveOnListenerError\n    });\n    if (errorCb) errorCb(err);\n  });\n  (0, _query.attachListener)(firebase, dispatch, meta, unsubscribe);\n}\n\nfunction setListeners(firebase, dispatch, listeners) {\n  if (!(0, _isArray3.default)(listeners)) {\n    throw new Error('Listeners must be an Array of listener configs (Strings/Objects).');\n  }\n\n  var config = firebase._.config;\n\n  if (config.oneListenerPerPath) {\n    return listeners.forEach(function (listener) {\n      var path = (0, _query.getQueryName)(listener);\n      var oldListenerCount = pathListenerCounts[path] || 0;\n      pathListenerCounts[path] = oldListenerCount + 1;\n\n      if (oldListenerCount > 0) {\n        return;\n      }\n\n      setListener(firebase, dispatch, listener);\n    });\n  }\n\n  return listeners.forEach(function (listener) {\n    var multipleListenersEnabled = (0, _isFunction3.default)(config.allowMultipleListeners) ? config.allowMultipleListeners(listener, firebase._.listeners) : config.allowMultipleListeners;\n\n    if (!(0, _query.listenerExists)(firebase, listener) || multipleListenersEnabled) {\n      setListener(firebase, dispatch, listener);\n    }\n  });\n}\n\nfunction unsetListener(firebase, dispatch, opts) {\n  return (0, _query.detachListener)(firebase, dispatch, (0, _query.getQueryConfig)(opts));\n}\n\nfunction unsetListeners(firebase, dispatch, listeners) {\n  if (!(0, _isArray3.default)(listeners)) {\n    throw new Error('Listeners must be an Array of listener configs (Strings/Objects).');\n  }\n\n  var config = firebase._.config;\n\n  if (config.oneListenerPerPath) {\n    listeners.forEach(function (listener) {\n      var path = (0, _query.getQueryName)(listener);\n      pathListenerCounts[path] -= 1;\n\n      if (pathListenerCounts[path] === 0) {\n        unsetListener(firebase, dispatch, listener);\n      }\n    });\n    return;\n  }\n\n  listeners.forEach(function (listener) {\n    unsetListener(firebase, dispatch, listener);\n  });\n}\n\nfunction runTransaction(firebase, dispatch, transactionPromise) {\n  return (0, _actions.wrapInDispatch)(dispatch, {\n    ref: firebase.firestore(),\n    method: 'runTransaction',\n    args: [transactionPromise],\n    types: [_constants.actionTypes.TRANSACTION_START, _constants.actionTypes.TRANSACTION_SUCCESS, _constants.actionTypes.TRANSACTION_FAILURE]\n  });\n}\n\nexports.default = {\n  get: get,\n  firestoreRef: _query.firestoreRef,\n  add: add,\n  update: update,\n  setListener: setListener,\n  setListeners: setListeners,\n  unsetListener: unsetListener,\n  unsetListeners: unsetListeners,\n  runTransaction: runTransaction\n};","map":{"version":3,"sources":["C:/Users/naren/Desktop/ReactApp-master/ReactApp-master/node_modules/redux-firestore/es/actions/firestore.js"],"names":["Object","defineProperty","exports","value","_every2","require","_every3","_interopRequireDefault","_isFunction2","_isFunction3","_invoke2","_invoke3","_isArray2","_isArray3","_extends","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","add","set","get","update","deleteRef","setListener","setListeners","unsetListener","unsetListeners","runTransaction","_actions","_constants","_query","obj","__esModule","default","pathListenerCounts","firebase","dispatch","queryOption","_len","args","Array","_key","meta","getQueryConfig","wrapInDispatch","ref","firestoreRef","method","types","actionTypes","ADD_REQUEST","type","ADD_SUCCESS","payload","snap","id","data","ADD_FAILURE","_len2","_key2","SET_REQUEST","SET_SUCCESS","SET_FAILURE","_ref","_","config","mergeOrdered","mergeOrderedDocUpdates","mergeOrderedCollectionUpdates","GET_REQUEST","GET_SUCCESS","dataByIdSnapshot","ordered","orderedFromSnap","merge","docs","collections","GET_FAILURE","_len3","_key3","UPDATE_REQUEST","UPDATE_SUCCESS","UPDATE_FAILURE","doc","subcollections","onAttemptCollectionDelete","Promise","reject","Error","DELETE_REQUEST","DELETE_SUCCESS","preserve","preserveOnDelete","DELETE_FAILURE","changeTypeToEventType","added","DOCUMENT_ADDED","removed","DOCUMENT_REMOVED","modified","DOCUMENT_MODIFIED","docChangeEvent","change","originalMeta","undefined","path","storeAs","oldIndex","newIndex","queryOpts","successCb","errorCb","_ref2","unsubscribe","onSnapshot","docData","docChanges","size","forEach","LISTENER_RESPONSE","err","_ref3","logListenerError","preserveOnListenerError","console","LISTENER_ERROR","attachListener","listeners","oneListenerPerPath","listener","getQueryName","oldListenerCount","multipleListenersEnabled","allowMultipleListeners","listenerExists","opts","detachListener","transactionPromise","firestore","TRANSACTION_START","TRANSACTION_SUCCESS","TRANSACTION_FAILURE"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _every2 = require('lodash/every');\n\nvar _every3 = _interopRequireDefault(_every2);\n\nvar _isFunction2 = require('lodash/isFunction');\n\nvar _isFunction3 = _interopRequireDefault(_isFunction2);\n\nvar _invoke2 = require('lodash/invoke');\n\nvar _invoke3 = _interopRequireDefault(_invoke2);\n\nvar _isArray2 = require('lodash/isArray');\n\nvar _isArray3 = _interopRequireDefault(_isArray2);\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nexports.add = add;\nexports.set = set;\nexports.get = get;\nexports.update = update;\nexports.deleteRef = deleteRef;\nexports.setListener = setListener;\nexports.setListeners = setListeners;\nexports.unsetListener = unsetListener;\nexports.unsetListeners = unsetListeners;\nexports.runTransaction = runTransaction;\n\nvar _actions = require('../utils/actions');\n\nvar _constants = require('../constants');\n\nvar _query = require('../utils/query');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar pathListenerCounts = {};\n\nfunction add(firebase, dispatch, queryOption) {\n  for (var _len = arguments.length, args = Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {\n    args[_key - 3] = arguments[_key];\n  }\n\n  var meta = (0, _query.getQueryConfig)(queryOption);\n  return (0, _actions.wrapInDispatch)(dispatch, {\n    ref: (0, _query.firestoreRef)(firebase, dispatch, meta),\n    method: 'add',\n    meta: meta,\n    args: args,\n    types: [_constants.actionTypes.ADD_REQUEST, {\n      type: _constants.actionTypes.ADD_SUCCESS,\n      payload: function payload(snap) {\n        return { id: snap.id, data: args[0] };\n      }\n    }, _constants.actionTypes.ADD_FAILURE]\n  });\n}\n\nfunction set(firebase, dispatch, queryOption) {\n  for (var _len2 = arguments.length, args = Array(_len2 > 3 ? _len2 - 3 : 0), _key2 = 3; _key2 < _len2; _key2++) {\n    args[_key2 - 3] = arguments[_key2];\n  }\n\n  var meta = (0, _query.getQueryConfig)(queryOption);\n  return (0, _actions.wrapInDispatch)(dispatch, {\n    ref: (0, _query.firestoreRef)(firebase, dispatch, meta),\n    method: 'set',\n    meta: meta,\n    args: args,\n    types: [_constants.actionTypes.SET_REQUEST, _constants.actionTypes.SET_SUCCESS, _constants.actionTypes.SET_FAILURE]\n  });\n}\n\nfunction get(firebase, dispatch, queryOption) {\n  var meta = (0, _query.getQueryConfig)(queryOption);\n\n  var _ref = firebase._.config || {},\n      mergeOrdered = _ref.mergeOrdered,\n      mergeOrderedDocUpdates = _ref.mergeOrderedDocUpdates,\n      mergeOrderedCollectionUpdates = _ref.mergeOrderedCollectionUpdates;\n\n  return (0, _actions.wrapInDispatch)(dispatch, {\n    ref: (0, _query.firestoreRef)(firebase, dispatch, meta),\n    method: 'get',\n    meta: meta,\n    types: [_constants.actionTypes.GET_REQUEST, {\n      type: _constants.actionTypes.GET_SUCCESS,\n      payload: function payload(snap) {\n        return {\n          data: (0, _query.dataByIdSnapshot)(snap),\n          ordered: (0, _query.orderedFromSnap)(snap)\n        };\n      },\n      merge: {\n        docs: mergeOrdered && mergeOrderedDocUpdates,\n        collections: mergeOrdered && mergeOrderedCollectionUpdates\n      }\n    }, _constants.actionTypes.GET_FAILURE]\n  });\n}\n\nfunction update(firebase, dispatch, queryOption) {\n  for (var _len3 = arguments.length, args = Array(_len3 > 3 ? _len3 - 3 : 0), _key3 = 3; _key3 < _len3; _key3++) {\n    args[_key3 - 3] = arguments[_key3];\n  }\n\n  var meta = (0, _query.getQueryConfig)(queryOption);\n  return (0, _actions.wrapInDispatch)(dispatch, {\n    ref: (0, _query.firestoreRef)(firebase, dispatch, meta),\n    method: 'update',\n    meta: meta,\n    args: args,\n    types: [_constants.actionTypes.UPDATE_REQUEST, _constants.actionTypes.UPDATE_SUCCESS, _constants.actionTypes.UPDATE_FAILURE]\n  });\n}\n\nfunction deleteRef(firebase, dispatch, queryOption) {\n  var meta = (0, _query.getQueryConfig)(queryOption);\n  var config = firebase._.config;\n\n  if (!meta.doc || meta.subcollections && !(0, _every3.default)(meta.subcollections, 'doc')) {\n    if ((0, _isFunction3.default)(config.onAttemptCollectionDelete)) {\n      return config.onAttemptCollectionDelete(queryOption, dispatch, firebase);\n    }\n    return Promise.reject(new Error('Only documents can be deleted.'));\n  }\n  return (0, _actions.wrapInDispatch)(dispatch, {\n    ref: (0, _query.firestoreRef)(firebase, dispatch, meta),\n    method: 'delete',\n    meta: meta,\n    types: [_constants.actionTypes.DELETE_REQUEST, {\n      type: _constants.actionTypes.DELETE_SUCCESS,\n      preserve: firebase._.config.preserveOnDelete\n    }, _constants.actionTypes.DELETE_FAILURE]\n  });\n}\n\nvar changeTypeToEventType = {\n  added: _constants.actionTypes.DOCUMENT_ADDED,\n  removed: _constants.actionTypes.DOCUMENT_REMOVED,\n  modified: _constants.actionTypes.DOCUMENT_MODIFIED\n};\n\nfunction docChangeEvent(change) {\n  var originalMeta = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  var meta = _extends({}, originalMeta, { path: change.doc.ref.path });\n  if (originalMeta.subcollections && !originalMeta.storeAs) {\n    meta.subcollections[0] = _extends({}, meta.subcollections[0], { doc: change.doc.id });\n  } else {\n    meta.doc = change.doc.id;\n  }\n  return {\n    type: changeTypeToEventType[change.type] || _constants.actionTypes.DOCUMENT_MODIFIED,\n    meta: meta,\n    payload: {\n      data: change.doc.data(),\n      ordered: { oldIndex: change.oldIndex, newIndex: change.newIndex }\n    }\n  };\n}\n\nfunction setListener(firebase, dispatch, queryOpts, successCb, errorCb) {\n  var meta = (0, _query.getQueryConfig)(queryOpts);\n\n  var _ref2 = firebase._.config || {},\n      mergeOrdered = _ref2.mergeOrdered,\n      mergeOrderedDocUpdates = _ref2.mergeOrderedDocUpdates,\n      mergeOrderedCollectionUpdates = _ref2.mergeOrderedCollectionUpdates;\n\n  var unsubscribe = (0, _query.firestoreRef)(firebase, dispatch, meta).onSnapshot(function (docData) {\n    var docChanges = typeof docData.docChanges === 'function' ? docData.docChanges() : docData.docChanges;\n\n    if (docChanges && docChanges.length < docData.size) {\n      if (docChanges.length === 1) {\n        dispatch(docChangeEvent(docChanges[0], meta));\n      } else {\n        docChanges.forEach(function (change) {\n          dispatch(docChangeEvent(change, meta));\n        });\n      }\n    } else {\n      dispatch({\n        type: _constants.actionTypes.LISTENER_RESPONSE,\n        meta: meta,\n        payload: {\n          data: (0, _query.dataByIdSnapshot)(docData),\n          ordered: (0, _query.orderedFromSnap)(docData)\n        },\n        merge: {\n          docs: mergeOrdered && mergeOrderedDocUpdates,\n          collections: mergeOrdered && mergeOrderedCollectionUpdates\n        }\n      });\n    }\n\n    if (successCb) successCb(docData);\n  }, function (err) {\n    var _ref3 = firebase._.config || {},\n        logListenerError = _ref3.logListenerError,\n        preserveOnListenerError = _ref3.preserveOnListenerError;\n\n    if (logListenerError) (0, _invoke3.default)(console, 'error', err);\n    dispatch({\n      type: _constants.actionTypes.LISTENER_ERROR,\n      meta: meta,\n      payload: err,\n      merge: {\n        docs: mergeOrdered && mergeOrderedDocUpdates,\n        collections: mergeOrdered && mergeOrderedCollectionUpdates\n      },\n      preserve: preserveOnListenerError\n    });\n\n    if (errorCb) errorCb(err);\n  });\n  (0, _query.attachListener)(firebase, dispatch, meta, unsubscribe);\n}\n\nfunction setListeners(firebase, dispatch, listeners) {\n  if (!(0, _isArray3.default)(listeners)) {\n    throw new Error('Listeners must be an Array of listener configs (Strings/Objects).');\n  }\n\n  var config = firebase._.config;\n\n  if (config.oneListenerPerPath) {\n    return listeners.forEach(function (listener) {\n      var path = (0, _query.getQueryName)(listener);\n      var oldListenerCount = pathListenerCounts[path] || 0;\n      pathListenerCounts[path] = oldListenerCount + 1;\n\n      if (oldListenerCount > 0) {\n        return;\n      }\n\n      setListener(firebase, dispatch, listener);\n    });\n  }\n\n  return listeners.forEach(function (listener) {\n    var multipleListenersEnabled = (0, _isFunction3.default)(config.allowMultipleListeners) ? config.allowMultipleListeners(listener, firebase._.listeners) : config.allowMultipleListeners;\n\n    if (!(0, _query.listenerExists)(firebase, listener) || multipleListenersEnabled) {\n      setListener(firebase, dispatch, listener);\n    }\n  });\n}\n\nfunction unsetListener(firebase, dispatch, opts) {\n  return (0, _query.detachListener)(firebase, dispatch, (0, _query.getQueryConfig)(opts));\n}\n\nfunction unsetListeners(firebase, dispatch, listeners) {\n  if (!(0, _isArray3.default)(listeners)) {\n    throw new Error('Listeners must be an Array of listener configs (Strings/Objects).');\n  }\n  var config = firebase._.config;\n\n  if (config.oneListenerPerPath) {\n    listeners.forEach(function (listener) {\n      var path = (0, _query.getQueryName)(listener);\n      pathListenerCounts[path] -= 1;\n\n      if (pathListenerCounts[path] === 0) {\n        unsetListener(firebase, dispatch, listener);\n      }\n    });\n\n    return;\n  }\n\n  listeners.forEach(function (listener) {\n    unsetListener(firebase, dispatch, listener);\n  });\n}\n\nfunction runTransaction(firebase, dispatch, transactionPromise) {\n  return (0, _actions.wrapInDispatch)(dispatch, {\n    ref: firebase.firestore(),\n    method: 'runTransaction',\n    args: [transactionPromise],\n    types: [_constants.actionTypes.TRANSACTION_START, _constants.actionTypes.TRANSACTION_SUCCESS, _constants.actionTypes.TRANSACTION_FAILURE]\n  });\n}\n\nexports.default = {\n  get: get,\n  firestoreRef: _query.firestoreRef,\n  add: add,\n  update: update,\n  setListener: setListener,\n  setListeners: setListeners,\n  unsetListener: unsetListener,\n  unsetListeners: unsetListeners,\n  runTransaction: runTransaction\n};"]},"metadata":{},"sourceType":"script"}