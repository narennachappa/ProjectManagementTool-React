{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _merge2 = require('lodash/fp/merge');\n\nvar _merge3 = _interopRequireDefault(_merge2);\n\nvar _isEqual2 = require('lodash/isEqual');\n\nvar _isEqual3 = _interopRequireDefault(_isEqual2);\n\nvar _keyBy2 = require('lodash/keyBy');\n\nvar _keyBy3 = _interopRequireDefault(_keyBy2);\n\nvar _map2 = require('lodash/map');\n\nvar _map3 = _interopRequireDefault(_map2);\n\nvar _omit2 = require('lodash/omit');\n\nvar _omit3 = _interopRequireDefault(_omit2);\n\nvar _reject2 = require('lodash/reject');\n\nvar _reject3 = _interopRequireDefault(_reject2);\n\nvar _unionBy2 = require('lodash/unionBy');\n\nvar _unionBy3 = _interopRequireDefault(_unionBy2);\n\nvar _get2 = require('lodash/get');\n\nvar _get3 = _interopRequireDefault(_get2);\n\nvar _size2 = require('lodash/size');\n\nvar _size3 = _interopRequireDefault(_size2);\n\nvar _actionHandlers;\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _slicedToArray = function () {\n  function sliceIterator(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i[\"return\"]) _i[\"return\"]();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  return function (arr, i) {\n    if (Array.isArray(arr)) {\n      return arr;\n    } else if (Symbol.iterator in Object(arr)) {\n      return sliceIterator(arr, i);\n    } else {\n      throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n    }\n  };\n}();\n\nexports.default = orderedReducer;\n\nvar _constants = require('../constants');\n\nvar _reducers = require('../utils/reducers');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  } else {\n    return Array.from(arr);\n  }\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar DOCUMENT_ADDED = _constants.actionTypes.DOCUMENT_ADDED,\n    GET_SUCCESS = _constants.actionTypes.GET_SUCCESS,\n    LISTENER_RESPONSE = _constants.actionTypes.LISTENER_RESPONSE,\n    CLEAR_DATA = _constants.actionTypes.CLEAR_DATA,\n    DELETE_SUCCESS = _constants.actionTypes.DELETE_SUCCESS,\n    DOCUMENT_REMOVED = _constants.actionTypes.DOCUMENT_REMOVED,\n    DOCUMENT_MODIFIED = _constants.actionTypes.DOCUMENT_MODIFIED;\n\nfunction modifyDoc(collectionState, action) {\n  if (!action.meta.subcollections || action.meta.storeAs) {\n    return (0, _reducers.updateItemInArray)(collectionState, action.meta.doc, function (item) {\n      return (0, _merge3.default)(item, action.payload.data);\n    });\n  }\n\n  var _pathToArr = (0, _reducers.pathToArr)(action.meta.path),\n      _pathToArr2 = _slicedToArray(_pathToArr, 4),\n      docId = _pathToArr2[1],\n      subcollectionName = _pathToArr2[2],\n      subDocId = _pathToArr2[3];\n\n  return (0, _reducers.updateItemInArray)(collectionState, docId, function (item) {\n    return _extends({}, item, _defineProperty({}, subcollectionName, (0, _reducers.updateItemInArray)((0, _get3.default)(item, subcollectionName, []), subDocId, function (subitem) {\n      return (0, _merge3.default)(subitem, action.payload.data);\n    })));\n  });\n}\n\nfunction addDoc() {\n  var array = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var action = arguments[1];\n  var meta = action.meta,\n      payload = action.payload;\n\n  if (!meta.subcollections || meta.storeAs) {\n    return [].concat(_toConsumableArray(array.slice(0, payload.ordered.newIndex)), [_extends({\n      id: meta.doc\n    }, payload.data)], _toConsumableArray(array.slice(payload.ordered.newIndex)));\n  }\n\n  return modifyDoc(array, action);\n}\n\nfunction removeDoc(array, action) {\n  if (!action.meta.subcollections || action.meta.storeAs) {\n    return (0, _reject3.default)(array, {\n      id: action.meta.doc\n    });\n  }\n\n  var subcollectionSetting = action.meta.subcollections[0];\n\n  if (!subcollectionSetting.doc) {\n    return (0, _reducers.updateItemInArray)(array, action.meta.doc, function (item) {\n      return (0, _omit3.default)(item, [subcollectionSetting.collection]);\n    });\n  }\n\n  return (0, _reducers.updateItemInArray)(array, action.meta.doc, function (item) {\n    var subcollectionVal = (0, _get3.default)(item, subcollectionSetting.collection, []);\n\n    if (subcollectionVal.length) {\n      return _extends({}, item, _defineProperty({}, subcollectionSetting.collection, (0, _reject3.default)(array, {\n        id: subcollectionSetting.doc\n      })));\n    }\n\n    return item;\n  });\n}\n\nfunction writeCollection(collectionState, action) {\n  var meta = action.meta,\n      _action$merge = action.merge,\n      merge = _action$merge === undefined ? {\n    doc: true,\n    collections: true\n  } : _action$merge;\n\n  if (meta.storeAs) {\n    return action.payload.ordered;\n  }\n\n  var collectionStateSize = (0, _size3.default)(collectionState);\n  var payloadExists = !!(0, _size3.default)(action.payload.ordered);\n\n  if (meta.doc && merge.doc && collectionStateSize) {\n    return modifyDoc(collectionState, action);\n  }\n\n  if (collectionStateSize && merge.collections) {\n    if (!payloadExists) {\n      return [];\n    }\n\n    var existingKeys = collectionState && (0, _keyBy3.default)(collectionState, 'id');\n    return (0, _map3.default)(action.payload.ordered, function (newDocObj) {\n      var existingDoc = (0, _get3.default)(existingKeys, newDocObj.id);\n      return !!existingDoc && !(0, _isEqual3.default)(existingDoc, newDocObj) ? _extends({}, existingDoc, newDocObj) : newDocObj;\n    });\n  }\n\n  if (meta.doc && meta.subcollections) {\n    var subcollectionConfig = meta.subcollections[0];\n\n    if (!collectionStateSize) {\n      return [_defineProperty({\n        id: meta.doc\n      }, subcollectionConfig.collection, action.payload.ordered)];\n    }\n\n    return (0, _reducers.updateItemInArray)(collectionState, meta.doc, function (item) {\n      return payloadExists ? _extends({}, item, _defineProperty({}, subcollectionConfig.collection, (0, _unionBy3.default)((0, _get3.default)(item, subcollectionConfig.collection, []), action.payload.ordered, 'id'))) : (0, _omit3.default)(item, [subcollectionConfig.collection]);\n    });\n  }\n\n  if (meta.doc && collectionStateSize) {\n    return (0, _reducers.updateItemInArray)(collectionState, meta.doc, function (item) {\n      return (0, _merge3.default)(item, action.payload.ordered[0]);\n    });\n  }\n\n  return action.payload.ordered;\n}\n\nvar actionHandlers = (_actionHandlers = {}, _defineProperty(_actionHandlers, DOCUMENT_ADDED, addDoc), _defineProperty(_actionHandlers, DOCUMENT_MODIFIED, modifyDoc), _defineProperty(_actionHandlers, DOCUMENT_REMOVED, removeDoc), _defineProperty(_actionHandlers, DELETE_SUCCESS, removeDoc), _defineProperty(_actionHandlers, LISTENER_RESPONSE, writeCollection), _defineProperty(_actionHandlers, GET_SUCCESS, writeCollection), _actionHandlers);\nvar orderedCollectionReducer = (0, _reducers.createReducer)(undefined, actionHandlers);\n\nfunction orderedReducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var action = arguments[1];\n\n  if (!action.type || !action.meta || !action.meta.storeAs && !action.meta.collection) {\n    return state;\n  }\n\n  if (action.type === CLEAR_DATA) {\n    if (action.preserve && action.preserve.ordered) {\n      return (0, _reducers.preserveValuesFromState)(state, action.preserve.ordered, {});\n    }\n\n    return {};\n  }\n\n  if (!Object.prototype.hasOwnProperty.call(actionHandlers, action.type)) {\n    return state;\n  }\n\n  var storeUnderKey = action.meta.storeAs || action.meta.collection;\n  var collectionStateSlice = (0, _get3.default)(state, storeUnderKey);\n  return _extends({}, state, _defineProperty({}, storeUnderKey, orderedCollectionReducer(collectionStateSlice, action)));\n}","map":{"version":3,"sources":["C:/Users/naren/Desktop/ReactApp-master/ReactApp-master/node_modules/redux-firestore/es/reducers/orderedReducer.js"],"names":["Object","defineProperty","exports","value","_merge2","require","_merge3","_interopRequireDefault","_isEqual2","_isEqual3","_keyBy2","_keyBy3","_map2","_map3","_omit2","_omit3","_reject2","_reject3","_unionBy2","_unionBy3","_get2","_get3","_size2","_size3","_actionHandlers","_extends","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","_slicedToArray","sliceIterator","arr","_arr","_n","_d","_e","undefined","_i","Symbol","iterator","_s","next","done","push","err","Array","isArray","TypeError","default","orderedReducer","_constants","_reducers","obj","__esModule","_toConsumableArray","arr2","from","_defineProperty","enumerable","configurable","writable","DOCUMENT_ADDED","actionTypes","GET_SUCCESS","LISTENER_RESPONSE","CLEAR_DATA","DELETE_SUCCESS","DOCUMENT_REMOVED","DOCUMENT_MODIFIED","modifyDoc","collectionState","action","meta","subcollections","storeAs","updateItemInArray","doc","item","payload","data","_pathToArr","pathToArr","path","_pathToArr2","docId","subcollectionName","subDocId","subitem","addDoc","array","concat","slice","ordered","newIndex","id","removeDoc","subcollectionSetting","collection","subcollectionVal","writeCollection","_action$merge","merge","collections","collectionStateSize","payloadExists","existingKeys","newDocObj","existingDoc","subcollectionConfig","actionHandlers","orderedCollectionReducer","createReducer","state","type","preserve","preserveValuesFromState","storeUnderKey","collectionStateSlice"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _merge2 = require('lodash/fp/merge');\n\nvar _merge3 = _interopRequireDefault(_merge2);\n\nvar _isEqual2 = require('lodash/isEqual');\n\nvar _isEqual3 = _interopRequireDefault(_isEqual2);\n\nvar _keyBy2 = require('lodash/keyBy');\n\nvar _keyBy3 = _interopRequireDefault(_keyBy2);\n\nvar _map2 = require('lodash/map');\n\nvar _map3 = _interopRequireDefault(_map2);\n\nvar _omit2 = require('lodash/omit');\n\nvar _omit3 = _interopRequireDefault(_omit2);\n\nvar _reject2 = require('lodash/reject');\n\nvar _reject3 = _interopRequireDefault(_reject2);\n\nvar _unionBy2 = require('lodash/unionBy');\n\nvar _unionBy3 = _interopRequireDefault(_unionBy2);\n\nvar _get2 = require('lodash/get');\n\nvar _get3 = _interopRequireDefault(_get2);\n\nvar _size2 = require('lodash/size');\n\nvar _size3 = _interopRequireDefault(_size2);\n\nvar _actionHandlers;\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nexports.default = orderedReducer;\n\nvar _constants = require('../constants');\n\nvar _reducers = require('../utils/reducers');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar DOCUMENT_ADDED = _constants.actionTypes.DOCUMENT_ADDED,\n    GET_SUCCESS = _constants.actionTypes.GET_SUCCESS,\n    LISTENER_RESPONSE = _constants.actionTypes.LISTENER_RESPONSE,\n    CLEAR_DATA = _constants.actionTypes.CLEAR_DATA,\n    DELETE_SUCCESS = _constants.actionTypes.DELETE_SUCCESS,\n    DOCUMENT_REMOVED = _constants.actionTypes.DOCUMENT_REMOVED,\n    DOCUMENT_MODIFIED = _constants.actionTypes.DOCUMENT_MODIFIED;\n\nfunction modifyDoc(collectionState, action) {\n  if (!action.meta.subcollections || action.meta.storeAs) {\n    return (0, _reducers.updateItemInArray)(collectionState, action.meta.doc, function (item) {\n      return (0, _merge3.default)(item, action.payload.data);\n    });\n  }\n\n  var _pathToArr = (0, _reducers.pathToArr)(action.meta.path),\n      _pathToArr2 = _slicedToArray(_pathToArr, 4),\n      docId = _pathToArr2[1],\n      subcollectionName = _pathToArr2[2],\n      subDocId = _pathToArr2[3];\n\n  return (0, _reducers.updateItemInArray)(collectionState, docId, function (item) {\n    return _extends({}, item, _defineProperty({}, subcollectionName, (0, _reducers.updateItemInArray)((0, _get3.default)(item, subcollectionName, []), subDocId, function (subitem) {\n      return (0, _merge3.default)(subitem, action.payload.data);\n    })));\n  });\n}\n\nfunction addDoc() {\n  var array = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var action = arguments[1];\n  var meta = action.meta,\n      payload = action.payload;\n\n  if (!meta.subcollections || meta.storeAs) {\n    return [].concat(_toConsumableArray(array.slice(0, payload.ordered.newIndex)), [_extends({ id: meta.doc }, payload.data)], _toConsumableArray(array.slice(payload.ordered.newIndex)));\n  }\n\n  return modifyDoc(array, action);\n}\n\nfunction removeDoc(array, action) {\n  if (!action.meta.subcollections || action.meta.storeAs) {\n    return (0, _reject3.default)(array, { id: action.meta.doc });\n  }\n\n  var subcollectionSetting = action.meta.subcollections[0];\n\n  if (!subcollectionSetting.doc) {\n    return (0, _reducers.updateItemInArray)(array, action.meta.doc, function (item) {\n      return (0, _omit3.default)(item, [subcollectionSetting.collection]);\n    });\n  }\n\n  return (0, _reducers.updateItemInArray)(array, action.meta.doc, function (item) {\n    var subcollectionVal = (0, _get3.default)(item, subcollectionSetting.collection, []);\n\n    if (subcollectionVal.length) {\n      return _extends({}, item, _defineProperty({}, subcollectionSetting.collection, (0, _reject3.default)(array, {\n        id: subcollectionSetting.doc\n      })));\n    }\n\n    return item;\n  });\n}\n\nfunction writeCollection(collectionState, action) {\n  var meta = action.meta,\n      _action$merge = action.merge,\n      merge = _action$merge === undefined ? { doc: true, collections: true } : _action$merge;\n\n  if (meta.storeAs) {\n    return action.payload.ordered;\n  }\n  var collectionStateSize = (0, _size3.default)(collectionState);\n  var payloadExists = !!(0, _size3.default)(action.payload.ordered);\n\n  if (meta.doc && merge.doc && collectionStateSize) {\n    return modifyDoc(collectionState, action);\n  }\n\n  if (collectionStateSize && merge.collections) {\n    if (!payloadExists) {\n      return [];\n    }\n\n    var existingKeys = collectionState && (0, _keyBy3.default)(collectionState, 'id');\n\n    return (0, _map3.default)(action.payload.ordered, function (newDocObj) {\n      var existingDoc = (0, _get3.default)(existingKeys, newDocObj.id);\n\n      return !!existingDoc && !(0, _isEqual3.default)(existingDoc, newDocObj) ? _extends({}, existingDoc, newDocObj) : newDocObj;\n    });\n  }\n\n  if (meta.doc && meta.subcollections) {\n    var subcollectionConfig = meta.subcollections[0];\n    if (!collectionStateSize) {\n      return [_defineProperty({\n        id: meta.doc\n      }, subcollectionConfig.collection, action.payload.ordered)];\n    }\n\n    return (0, _reducers.updateItemInArray)(collectionState, meta.doc, function (item) {\n      return payloadExists ? _extends({}, item, _defineProperty({}, subcollectionConfig.collection, (0, _unionBy3.default)((0, _get3.default)(item, subcollectionConfig.collection, []), action.payload.ordered, 'id'))) : (0, _omit3.default)(item, [subcollectionConfig.collection]);\n    });\n  }\n\n  if (meta.doc && collectionStateSize) {\n    return (0, _reducers.updateItemInArray)(collectionState, meta.doc, function (item) {\n      return (0, _merge3.default)(item, action.payload.ordered[0]);\n    });\n  }\n\n  return action.payload.ordered;\n}\n\nvar actionHandlers = (_actionHandlers = {}, _defineProperty(_actionHandlers, DOCUMENT_ADDED, addDoc), _defineProperty(_actionHandlers, DOCUMENT_MODIFIED, modifyDoc), _defineProperty(_actionHandlers, DOCUMENT_REMOVED, removeDoc), _defineProperty(_actionHandlers, DELETE_SUCCESS, removeDoc), _defineProperty(_actionHandlers, LISTENER_RESPONSE, writeCollection), _defineProperty(_actionHandlers, GET_SUCCESS, writeCollection), _actionHandlers);\n\nvar orderedCollectionReducer = (0, _reducers.createReducer)(undefined, actionHandlers);\n\nfunction orderedReducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var action = arguments[1];\n\n  if (!action.type || !action.meta || !action.meta.storeAs && !action.meta.collection) {\n    return state;\n  }\n\n  if (action.type === CLEAR_DATA) {\n    if (action.preserve && action.preserve.ordered) {\n      return (0, _reducers.preserveValuesFromState)(state, action.preserve.ordered, {});\n    }\n    return {};\n  }\n\n  if (!Object.prototype.hasOwnProperty.call(actionHandlers, action.type)) {\n    return state;\n  }\n\n  var storeUnderKey = action.meta.storeAs || action.meta.collection;\n  var collectionStateSlice = (0, _get3.default)(state, storeUnderKey);\n  return _extends({}, state, _defineProperty({}, storeUnderKey, orderedCollectionReducer(collectionStateSlice, action)));\n}"]},"metadata":{},"sourceType":"script"}